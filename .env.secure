# SECURE CONFIGURATION - HARDENED SECURITY SETTINGS
# This configuration addresses all security gaps found in ultrathink audit

# ============================================================================
# CRITICAL SECURITY SETTINGS - MUST BE ENABLED
# ============================================================================

# Authentication & Authorization (CRITICAL!)
API_KEY_REQUIRED=true                    # MUST be true for production
API_KEY_MIN_LENGTH=32                    # Minimum API key length
REQUIRE_HTTPS=true                       # Force HTTPS connections
JWT_SECRET_KEY=${JWT_SECRET_KEY}         # Set via environment variable
JWT_ALGORITHM=HS256                      # JWT signing algorithm
JWT_EXPIRY_HOURS=24                      # Token expiration time
ENABLE_MFA=true                          # Multi-factor authentication

# Rate Limiting & DoS Protection
API_RATE_LIMIT_REQUESTS=100              # Max requests per window
API_RATE_LIMIT_WINDOW=60                 # Time window in seconds
BURST_RATE_LIMIT=10                      # Burst request limit
CIRCUIT_BREAKER_THRESHOLD=5              # Circuit breaker failure threshold
CIRCUIT_BREAKER_TIMEOUT=300              # Circuit breaker timeout seconds

# Request Size Limits
MAX_REQUEST_SIZE=10485760                # 10MB max request size
MAX_UPLOAD_SIZE=104857600                # 100MB max upload size
MAX_URL_LENGTH=2000                      # Maximum URL length
MAX_HEADER_SIZE=8192                     # Maximum header size
REQUEST_TIMEOUT=30                       # Request timeout seconds

# CORS Security
CORS_ALLOWED_ORIGINS=https://localhost:3000,https://yourdomain.com
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOWED_METHODS=GET,POST
CORS_ALLOWED_HEADERS=Authorization,Content-Type
CORS_MAX_AGE=3600

# Session Security
SESSION_TIMEOUT=3600                     # Session timeout in seconds
SESSION_SECURE_COOKIE=true               # Secure cookie flag
SESSION_HTTPONLY=true                    # HttpOnly cookie flag
SESSION_SAMESITE=strict                  # SameSite cookie attribute

# Database Security
DATABASE_ENCRYPTION=true                 # Enable database encryption
DATABASE_CONNECTION_LIMIT=10             # Max database connections
DATABASE_QUERY_TIMEOUT=5000              # Query timeout milliseconds
DATABASE_SSL_MODE=require                # Require SSL for database

# File System Security
FILE_PERMISSIONS=0600                    # Restrictive file permissions
DIRECTORY_PERMISSIONS=0700               # Restrictive directory permissions
TEMP_FILE_CLEANUP=true                   # Auto-cleanup temp files
MAX_FILE_AGE_DAYS=30                    # Max file retention days

# Storage Security
STORAGE_QUOTA_ENABLED=true               # Enable storage quotas
USER_STORAGE_QUOTA_GB=10                 # Per-user storage limit
TOTAL_STORAGE_QUOTA_GB=100               # Total storage limit
STORAGE_CLEANUP_INTERVAL=3600            # Cleanup interval seconds

# Process Security
ENABLE_PROCESS_ISOLATION=true            # Process sandboxing
MAX_MEMORY_MB=512                        # Max memory per process
MAX_CPU_PERCENT=50                       # Max CPU usage percent
PROCESS_TIMEOUT=300                      # Process timeout seconds

# Network Security
ENABLE_FIREWALL=true                     # Enable firewall rules
ALLOWED_IP_RANGES=10.0.0.0/8,192.168.0.0/16
BLOCKED_IP_RANGES=0.0.0.0/8
DNS_TIMEOUT=5                            # DNS lookup timeout
SSL_VERIFY=true                          # Verify SSL certificates
MIN_TLS_VERSION=1.2                      # Minimum TLS version

# Logging & Monitoring
SECURITY_LOGGING=true                    # Enable security logging
AUDIT_LOGGING=true                       # Enable audit trails
LOG_SENSITIVE_DATA=false                 # Don't log sensitive data
LOG_ROTATION=true                        # Enable log rotation
LOG_RETENTION_DAYS=90                   # Log retention period
ALERT_ON_SUSPICIOUS=true                 # Alert on suspicious activity

# Error Handling
HIDE_ERROR_DETAILS=true                  # Hide detailed errors in production
GENERIC_ERROR_MESSAGE=true               # Use generic error messages
STACK_TRACE_IN_LOGS_ONLY=true           # Stack traces only in logs

# Content Security
ENABLE_CSP=true                          # Content Security Policy
CSP_POLICY="default-src 'self'; script-src 'none'; object-src 'none';"
ENABLE_XSS_PROTECTION=true               # XSS protection header
ENABLE_CONTENT_TYPE_OPTIONS=true         # X-Content-Type-Options
ENABLE_FRAME_OPTIONS=true                # X-Frame-Options

# Input Validation
STRICT_INPUT_VALIDATION=true             # Strict input validation
REJECT_MALICIOUS_PATTERNS=true           # Reject known attack patterns
SANITIZE_ALL_INPUT=true                  # Sanitize all user input
VALIDATE_URL_FORMAT=true                 # Validate URL formats
MAX_INPUT_LENGTH=10000                   # Max input string length

# API Security
API_VERSION_CONTROL=true                 # API versioning
DEPRECATION_WARNING_DAYS=30              # Deprecation warning period
REQUIRE_USER_AGENT=true                  # Require User-Agent header
BLOCK_SUSPICIOUS_AGENTS=true             # Block suspicious user agents

# Secrets Management
USE_SECRET_MANAGER=true                  # Use external secret manager
ROTATE_SECRETS=true                      # Enable secret rotation
SECRET_ROTATION_DAYS=90                  # Secret rotation period
ENCRYPT_SECRETS_AT_REST=true            # Encrypt stored secrets

# Backup & Recovery
ENABLE_BACKUPS=true                      # Enable automatic backups
BACKUP_ENCRYPTION=true                   # Encrypt backup files
BACKUP_RETENTION_DAYS=30                 # Backup retention period
DISASTER_RECOVERY=true                   # Enable disaster recovery

# Compliance & Standards
ENABLE_GDPR_COMPLIANCE=true              # GDPR compliance mode
ENABLE_PCI_COMPLIANCE=true               # PCI DSS compliance
ENABLE_HIPAA_COMPLIANCE=false            # HIPAA compliance
DATA_RETENTION_POLICY=true               # Data retention enforcement

# Security Updates
AUTO_SECURITY_UPDATES=true               # Auto-apply security updates
VULNERABILITY_SCANNING=true              # Enable vulnerability scanning
DEPENDENCY_CHECK=true                    # Check dependency vulnerabilities
SECURITY_PATCH_ALERTS=true               # Alert on security patches

# Incident Response
INCIDENT_RESPONSE_ENABLED=true           # Enable incident response
INCIDENT_CONTACT_EMAIL=security@yourdomain.com
INCIDENT_RESPONSE_TIME=15                # Response time in minutes
AUTO_BLOCK_ATTACKS=true                  # Auto-block detected attacks

# Testing & Validation
SECURITY_TESTING_ENABLED=true            # Enable security testing
PENETRATION_TESTING=true                 # Allow penetration testing
FUZZING_ENABLED=true                     # Enable fuzz testing
STATIC_ANALYSIS=true                     # Static code analysis

# ============================================================================
# APPLICATION SETTINGS (with security hardening)
# ============================================================================

# Deployment
DEPLOYMENT_MODE=PRODUCTION               # Production mode
DEBUG=false                              # MUST be false in production
DEVELOPMENT_MODE=false                   # Disable development features

# Storage (with security)
STORAGE_PATH=/secure/storage/path        # Secure storage location
STORAGE_ENCRYPTION=true                  # Encrypt stored files

# Database (with security)
DATABASE_URL=sqlite:///secure/data/yt-dl-sub.db
DATABASE_BACKUP_PATH=/secure/backups/

# AI Backend (with security)
AI_BACKEND=claude_api                    # Use API with authentication
AI_MODEL=claude-3-haiku-20240307
AI_MAX_TOKENS=2000
AI_REQUEST_TIMEOUT=30
AI_RATE_LIMIT=60

# YouTube Settings (with security)
YOUTUBE_RATE_LIMIT=10
YOUTUBE_CONCURRENT_DOWNLOADS=2
YOUTUBE_URL_VALIDATION=strict            # Strict URL validation
YOUTUBE_CONTENT_FILTERING=true           # Content filtering

# Worker Settings (with security)
WORKER_CONCURRENCY=3
WORKER_ISOLATION=true                    # Worker process isolation
WORKER_HEALTH_CHECK=true                 # Worker health monitoring

# API Settings (secured)
API_HOST=127.0.0.1                       # Localhost only
API_PORT=8004
API_WORKERS=4
API_SSL_CERT=/path/to/cert.pem          # SSL certificate
API_SSL_KEY=/path/to/key.pem            # SSL private key

# Queue (with security)
QUEUE_TYPE=redis                         # Use Redis for production
QUEUE_ENCRYPTION=true                    # Encrypt queue messages
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=${REDIS_PASSWORD}         # Set via environment
REDIS_SSL=true                          # Use SSL for Redis

# ============================================================================
# CREDENTIAL SECURITY (use environment variables or secret manager)
# ============================================================================

# NEVER store actual credentials in this file
# Use environment variables or external secret manager

CLAUDE_API_KEY=${CLAUDE_API_KEY}
OPENAI_API_KEY=${OPENAI_API_KEY}
GEMINI_API_KEY=${GEMINI_API_KEY}
GDRIVE_CREDENTIALS_FILE=${GDRIVE_CREDENTIALS_FILE}
AIRTABLE_API_KEY=${AIRTABLE_API_KEY}

# ============================================================================
# SECURITY MONITORING
# ============================================================================

# Monitoring endpoints
MONITORING_ENABLED=true
METRICS_ENDPOINT=/metrics
HEALTH_ENDPOINT=/health
STATUS_ENDPOINT=/status

# Alerting
ALERT_EMAIL=security@yourdomain.com
ALERT_WEBHOOK=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
ALERT_THRESHOLD_ERRORS=10
ALERT_THRESHOLD_ATTACKS=5

# Security metrics
TRACK_FAILED_LOGINS=true
TRACK_RATE_LIMITS=true
TRACK_MALICIOUS_REQUESTS=true
TRACK_RESOURCE_USAGE=true

# ============================================================================
# ADDITIONAL SECURITY NOTES
# ============================================================================

# 1. Always use environment variables for sensitive values
# 2. Rotate all secrets and API keys regularly
# 3. Monitor security logs and alerts
# 4. Keep all dependencies updated
# 5. Perform regular security audits
# 6. Test disaster recovery procedures
# 7. Train team on security best practices
# 8. Document all security procedures
# 9. Have an incident response plan
# 10. Never disable security features in production